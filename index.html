<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Pixel Art Maker v1.3 ‚Äî Alex Johnston</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    #sceneLibrary {
      max-height: 200px;
      overflow-y: auto;
      border: 1px solid #ccc;
      padding: 5px;
      margin-top: 8px;
    }
    .scene-btn {
      display: block;
      margin-bottom: 5px;
      width: calc(100% - 50px);
    }
    .scene-wrapper {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 5px;
    }
    .delete-btn {
      background-color: #e33;
      color: #fff;
      border: none;
      padding: 4px 8px;
      cursor: pointer;
    }
    #paletteSidebar {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 6px;
      margin-top: 12px;
    }
    .palette-slot {
      width: 30px;
      height: 30px;
      border: 1px solid #aaa;
      background-color: transparent;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div id="layout">
    <aside id="sidebar">
      <h2>üõ†Ô∏è Tools</h2>

      <div class="tool-section">
        <label class="toggle">
          <input type="radio" name="mode" value="color" checked />
          <span class="tag">Paint Color</span>
        </label>
        <label class="toggle">
          <input type="radio" name="mode" value="transparent" />
          <span class="tag">Erase Transparent</span>
        </label>
      </div>

      <div class="tool-section">
        <label class="toggle">
          <input type="checkbox" id="dragToggle" checked />
          <span class="tag">Enable Drag Drawing</span>
        </label>
      </div>

      <div class="tool-section">
        <label for="resolution">üéûÔ∏è Resolution</label>
        <select id="resolution">
          <option value="16">8-bit (16√ó16)</option>
          <option value="32">24-bit (32√ó32)</option>
          <option value="64" selected>64-bit (64√ó64)</option>
          <option value="128">128-bit (128√ó128)</option>
        </select>
      </div>

      <div class="tool-section">
        <label>üé® Saved Scenes</label>
        <div id="sceneLibrary"></div>
      </div>

      <div class="tool-section">
        <label>üíæ Saved Colors</label>
        <div id="paletteSidebar"></div>
      </div>

      <div class="tool-section">
        <button onclick="location.href='about.html'" id="aboutBtn">üìñ About This App</button>
      </div>
    </aside>

    <main>
      <header>
        <h1>üß± Pixel Art Maker</h1>
        <p class="subheading">Retro-powered pixels, handcrafted by Alex Johnston</p>
      </header>

      <section id="controls">
        <input type="color" id="colorPicker" value="#ff0000" />
        <button id="saveBtn">üíæ Save PNG</button>
        <button id="clearTransparentBtn">üßº Fill Transparent</button>
        <button id="saveFrameBtn">üì∏ Save Frame</button>
      </section>

      <div id="grid"></div>
      <canvas id="canvas" width="640" height="640"></canvas>

      <footer>
        <div class="dev-info">
          <strong>Version 1.3</strong> ‚Äî Built by <strong>Alex Johnston</strong><br />
          <a href="https://github.com/ajohnston49" target="_blank">GitHub: ajohnston49</a><br />
          <span>Modular coder | Pixel engineer | Fast thinker</span>
        </div>
      </footer>
    </main>
  </div>

  <script>
    const grid = document.getElementById('grid');
    const resolution = document.getElementById('resolution');
    const colorPicker = document.getElementById('colorPicker');
    const saveBtn = document.getElementById('saveBtn');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const dragToggle = document.getElementById('dragToggle');
    const clearTransparentBtn = document.getElementById('clearTransparentBtn');
    const saveFrameBtn = document.getElementById('saveFrameBtn');
    const sceneLibrary = document.getElementById('sceneLibrary');
    const paletteSidebar = document.getElementById('paletteSidebar');

    let cells = [];
    let currentColor = colorPicker.value;
    let paintMode = 'color';
    let gridSize = parseInt(resolution.value);
    const canvasSize = 640;
    let isMouseDown = false;
    let dragEnabled = dragToggle.checked;
    let savedScenes = [];
    let colorPalette = new Array(10).fill(null);
    const paletteSlots = [];

    function saveToStorage() {
      localStorage.setItem('pixelArtScenes', JSON.stringify(savedScenes));
      localStorage.setItem('pixelArtPalette', JSON.stringify(colorPalette));
    }

    function loadFromStorage() {
      const sceneData = localStorage.getItem('pixelArtScenes');
      if (sceneData) {
        savedScenes = JSON.parse(sceneData);
        savedScenes.forEach((scene, index) => {
          if (scene) createSceneEntry(scene, index);
        });
      }

      const paletteData = localStorage.getItem('pixelArtPalette');
      if (paletteData) {
        colorPalette = JSON.parse(paletteData);
        colorPalette.forEach((color, i) => {
          if (color) paletteSlots[i].style.backgroundColor = color;
        });
      }
    }

    function createSceneEntry(scene, index) {
      const wrapper = document.createElement('div');
      wrapper.className = 'scene-wrapper';

      const btn = document.createElement('button');
      btn.textContent = `Scene ${index + 1} (${scene.resolution}√ó${scene.resolution})`;
      btn.className = 'scene-btn';
      btn.onclick = () => {
        if (confirm('Load scene?')) {
          resolution.value = scene.resolution;
          createGrid(scene.resolution);
          setTimeout(() => {
            scene.state.forEach((color, i) => {
              if (cells[i]) cells[i].style.background = color;
            });
          }, 10);
        }
      };

      const deleteBtn = document.createElement('button');
      deleteBtn.textContent = 'üóë';
      deleteBtn.className = 'delete-btn';
      deleteBtn.onclick = () => {
        savedScenes[index] = null;
        saveToStorage();
        sceneLibrary.removeChild(wrapper);
      };

      wrapper.appendChild(btn);
      wrapper.appendChild(deleteBtn);
      sceneLibrary.appendChild(wrapper);
    }

    dragToggle.addEventListener('change', e => dragEnabled = e.target.checked);
    document.body.addEventListener('mousedown', () => isMouseDown = true);
    document.body.addEventListener('mouseup', () => isMouseDown = false);

    function clearGrid() {
      grid.innerHTML = '';
      cells = [];
    }

    function createGrid(size) {
      clearGrid();
      gridSize = size;
      const cellSize = canvasSize / size;

      grid.style.width = `${canvasSize}px`;
      grid.style.height = `${canvasSize}px`;
      grid.style.gridTemplateColumns = `repeat(${size}, ${cellSize}px)`;
      grid.style.gridTemplateRows = `repeat(${size}, ${cellSize}px)`;

      canvas.width = canvasSize;
      canvas.height = canvasSize;

      for (let i = 0; i < size * size; i++) {
        const cell = document.createElement('div');
        cell.className = 'cell';
        cell.style.width = `${cellSize}px`;
        cell.style.height = `${cellSize}px`;
        grid.appendChild(cell);
        cells.push(cell);

        cell.addEventListener('mousedown', () => applyPaint(cell));
        cell.addEventListener('mouseenter', () => {
          if (isMouseDown && dragEnabled) applyPaint(cell);
        });
      }
    }

    function applyPaint(cell) {
      cell.style.background = (paintMode === 'color') ? currentColor : 'rgba(0,0,0,0)';
    }

    colorPicker.addEventListener('input', () => currentColor = colorPicker.value);
    resolution.addEventListener('change', () => createGrid(parseInt(resolution.value)));
    document.querySelectorAll('input[name="mode"]').forEach(radio => {
      radio.addEventListener('change', () => paintMode = radio.value);
    });

    clearTransparentBtn.onclick = () => {
      cells.forEach(cell => cell.style.background = 'rgba(0,0,0,0)');
    };

    saveFrameBtn.onclick = () => {
      const state = cells.map(cell => window.getComputedStyle(cell).backgroundColor);
      const res = gridSize;
      const sceneId = savedScenes.length;
      const newScene = { state, resolution: res };
      savedScenes.push(newScene);
      saveToStorage();
      createSceneEntry(newScene, sceneId);
    };

    saveBtn.onclick = () => {
      let cellSize;
      if (gridSize === 16) cellSize = 40;
      else if (gridSize === 32) cellSize = 20;
      else if (gridSize === 64) cellSize = 10;
      else if (gridSize === 128) cellSize = 5;
      else cellSize = canvasSize / gridSize;

      cells.forEach((cell, i) => {
        const col = i % gridSize;
        const row = Math.floor(i / gridSize);
        const bg = window.getComputedStyle(cell).backgroundColor;
        ctx.fillStyle = bg.includes('rgba(0, 0, 0, 0)') ? 'rgba(0,0,0,0)' : bg;
        ctx.fillRect(col * cellSize, row * cellSize, cellSize, cellSize);
      });

      const link = document.createElement('a');
      link.download = `pixel_art_${gridSize}x${gridSize}.png`;
      link.href = canvas.toDataURL();
      link.click();
    };

    // üé® Initialize Palette Slots
    for (let i = 0; i < 10; i++) {
      const slot = document.createElement('div');
      slot.className = 'palette-slot';
      slot.addEventListener('click', () => {
        const saved = colorPalette[i];
        if (!saved) {
          if (confirm('Save current color to this slot?')) {
            colorPalette[i] = currentColor;
            slot.style.backgroundColor = currentColor;
            saveToStorage();
          }
        } else {
          currentColor = saved;
          colorPicker.value = saved;
        }
      });
      paletteSidebar.appendChild(slot);
      paletteSlots.push(slot);
    }

    createGrid(gridSize);
    loadFromStorage();
  </script>
</body>
</html>

